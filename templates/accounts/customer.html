{% extends 'accounts/main.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<style>
    .sidebar {
        height: 100vh;
        background-color: #343a40;
        color: #fff;
    }

    .sidebar .nav-link {
        color: #fff;
    }

    .sidebar .nav-link.active {
        background-color: #495057;
        font-weight: bold;
    }

    .sidebar .nav-link:hover {
        background-color: #495057;
        color: #fff;
    }

    .logout-link {
        color: #fff;
    }

    .logout-link:hover {
        color: #fff;
        text-decoration: none;
        background-color: #495057;
    }
</style>

<div class="container-fluid mt-4">
    <div class="row">

        <!-- Sidebar -->
        <div class="col-md-2 p-0">
            <div class="sidebar d-flex flex-column p-3">
                <h5 class="mb-4">Customer Panel</h5>

                <ul class="nav flex-column mb-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'user-page' %}">
                            <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'customer_orders' customer.id 'Patch' %}">
                            <i class="fas fa-certificate me-2"></i> Patches Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'customer_orders' customer.id 'Digitizing' %}">
                            <i class="fas fa-magic me-2"></i> Digitizing Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'customer_orders' customer.id 'Quote' %}">
                            <i class="fas fa-file-invoice-dollar me-2"></i> Quotes Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'customer_orders' customer.id 'Vector' %}">
                            <i class="fas fa-vector-square me-2"></i> Vectors Orders
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'customer_invoices' customer.id %}">
                            <i class="fas fa-file-invoice me-2"></i> Invoices
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'account' %}">
                            <i class="fas fa-user me-2"></i> My Profile
                        </a>
                    </li>
                </ul>

                <!-- Logout at Bottom -->
                <div class="mt-auto">
                    <a class="nav-link logout-link" href="{% url 'logout' %}">
                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-10">

            <a href="{% url 'user-page' %}" class="btn btn-outline-secondary btn-sm mb-3">
                <i class="bi bi-arrow-left-circle"></i> Back
            </a>

            <!-- Customer Summary -->
            <div class="row g-3">
                <div class="col-md">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5>Customer:</h5>
                            <hr>
                            <a class="btn btn-outline-info btn-sm w-100 mb-2"
                               href="{% url 'update_customer' customer.id %}">
                               Update Customer
                            </a>
                            <a class="btn btn-outline-info btn-sm w-100"
                               href="{% url 'create_order' customer.id 'design' %}">
                               Place Order
                            </a>
                        </div>
                    </div>
                </div>

                <div class="col-md">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5>Contact Information</h5>
                            <hr>
                            <p>Email: {{ customer.email }}</p>
                            <p>Phone: {{ customer.phone }}</p>
                        </div>
                    </div>
                </div>

                <div class="col-md">
                    <div class="card shadow-sm text-center">
                        <div class="card-body">
                            <h5>Total Orders</h5>
                            <h1 class="py-2">{{ total_order }}</h1>
                        </div>
                    </div>
                </div>
            </div>

            <br>

            <!-- Filter/Search -->
            <div class="row">
                <div class="col">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <form method="get" class="row g-2">
                                {% for field in myFilter.form %}
                                <div class="col-md-3">
                                    {{ field.label_tag }}
                                    {{ field }}
                                </div>
                                {% endfor %}

                                {% if request.user.is_staff or request.user.is_superuser %}
                                <div class="col-md-2 d-flex align-items-end">
                                    <button class="btn btn-primary w-100" type="submit">
                                        Search
                                    </button>
                                </div>
                                {% endif %}
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <br>

            <!-- Orders Table -->
            <div class="row">
                <div class="col-md">
                    <div class="card shadow-sm">
                        <div class="card-body">

                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#" role="tab">General Info</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="{% url 'released_orders' %}">Files</a>
                                </li>
                            </ul>

                            <div class="table-responsive mt-3">
                                <table class="table table-striped table-bordered align-middle">
                                    <thead class="table-light text-center">
                                        <tr>
                                            <th>Order Name/PO</th>
                                            <th>Order Type</th>
                                            <th>Quantity</th>
                                            <th>Fabric</th>
                                            <th>Format</th>
                                            <th>Height</th>
                                            <th>Width</th>
                                            <th>Colors</th>
                                            <th>Placement</th>
                                            <th>Payment</th>
                                            <th>Urgent</th>
                                            <th>Turnaround</th>
                                            <th>Price</th>
                                            <th>Status</th>
                                            <th>Date Ordered</th>
                                            <th>Date Completed</th>
                                            <th>Sales Rep</th>
                                            <th>Designer</th>
                                            <th>Update</th>
                                            <th>Remove</th>
                                            <th>Invoice</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for order in orders %}
                                        <tr>
                                            <td>{{ order.Order_name_PO }}</td>
                                            <td>{{ order.order_type }}</td>
                                            <td>{{ order.quantity }}</td>
                                            <td>{{ order.fabric_material }}</td>
                                            <td>{{ order.Required_Format }}</td>
                                            <td>{{ order.Height }}</td>
                                            <td>{{ order.Width }}</td>
                                            <td>{{ order.total_colors }}</td>
                                            <td>{{ order.placement }}</td>

                                            <td>
                                                {% if order.payment_status == "Paid" %}✅ Paid
                                                {% elif order.payment_status == "Pending" %}⏳ Pending
                                                {% elif order.payment_status == "Failed" %}❌ Failed
                                                {% else %}{{ order.payment_status }}{% endif %}
                                            </td>

                                            <td class="text-center">
                                                {% if order.urgent %}✅{% else %}❌{% endif %}
                                            </td>

                                            <td>{{ order.turnaround_time }}</td>
                                            <td>${{ order.price }}</td>
                                            <td>{{ order.status }}</td>
                                            <td>{{ order.date_created }}</td>
                                            <td>{{ order.date_completed }}</td>
                                            <td>{{ order.customer.sales_rep.name }}</td>
                                            <td>{{ order.assigned_designer.username }}</td>

                                            <td>
                                                <a class="btn btn-sm btn-info"
                                                   href="{% url 'update_order' order.id %}">
                                                   Update
                                                </a>
                                            </td>
                                            <td>
                                                <a class="btn btn-sm btn-danger"
                                                   href="{% url 'delete_order' order.id %}">
                                                   Remove
                                                </a>
                                            </td>
                                            <td>
                                                <a class="btn btn-sm btn-secondary"
                                                   href="{% url 'print_invoice' order.id %}">
                                                   Invoice
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}
