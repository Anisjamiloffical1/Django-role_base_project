{% extends "accounts/main.html" %}
{% load static %}

{% block content %}

<div class="container-fluid">
    <div class="row">

        <!-- ================= SIDEBAR ================= -->
        <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar shadow-sm min-vh-100">
            <div class="px-3 py-4">
                <h5 class="fw-bold mb-4">ğŸ“Š Sales Panel</h5>

                <ul class="nav flex-column">
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'sales-dashboard' %}">ğŸ  Dashboard</a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'manage_customers' %}">ğŸ‘¥ My Customers</a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'monitor_quotes' %}">ğŸ“¦ Active Orders</a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'track_orders' %}">ğŸ“ Quote Requests</a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'release_projects' %}">âœ… Released Projects</a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'follow_up_payments' %}">ğŸ’³ Follow Up</a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link active fw-bold" href="{% url 'sales_rep_inbox' %}">ğŸ“¥ Inbox</a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'communicate_sales_rep' %}">ğŸ“¤ Sent Messages</a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- ================= MAIN CONTENT ================= -->
        <main class="col-md-9 col-lg-10 px-4 py-4">

            <h2 class="mb-4">ğŸ“¨ Inbox</h2>
            <p>You have <strong>{{ unread_count }}</strong> unread messages.</p>

            {% if messages %}
                <ul class="list-group">
                    {% for msg in messages %}
                        <li class="list-group-item {% if not msg.is_read %}list-group-item-warning{% endif %}">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>{{ msg.sender.username }}</strong> â†’ 
                                    <span class="text-muted">{{ msg.receiver.username }}</span>
                                    <p class="mb-1">{{ msg.message|truncatewords:15 }}</p>
                                    <small class="text-muted">{{ msg.timestamp|date:"M d, Y H:i" }}</small>
                                </div>
                                <div>
                                    <a href="{% url 'view_message' msg.id %}" class="btn btn-sm btn-primary">
                                        View
                                    </a>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="alert alert-info mt-3">
                    No messages found.
                </div>
            {% endif %}

        </main>

    </div>
</div>

{% endblock %}
