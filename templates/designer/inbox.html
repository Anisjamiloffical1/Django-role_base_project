{% extends 'accounts/main.html' %}

{% block content %}
<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 bg-dark text-white vh-100 p-3">
      <h4 class="mb-4">Designer Menu</h4>
      <ul class="nav flex-column">
        <li class="nav-item mb-2">
          <a href="{% url 'designer-dashboard' %}" class="nav-link text-white">
            <i class="fas fa-clipboard-list"></i> Assigned Orders
          </a>
        </li>
        <li class="nav-item mb-2">
          <a href="{% url 'communicate_with_sales_admin' %}" class="nav-link text-white">
            <i class="fas fa-paper-plane"></i> Send Message
          </a>
        </li>
        <li class="nav-item mb-2">
          <a href="{% url 'designer_feedback' %}" class="nav-link text-white">
            <i class="fas fa-comments"></i> Feedback / Revisions
          </a>
        </li>
        <li class="nav-item mt-auto">
          <a class="nav-link text-white" href="{% url 'logout' %}">
            <i class="fas fa-sign-out-alt"></i> Logout
          </a>
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="col-md-9 col-lg-10 p-4">
      <h2>Designer Inbox</h2>

      {% if messages %}
        <div class="table-responsive">
          <table class="table table-hover mt-3">
            <thead>
              <tr>
                <th>From</th>
                <th>Order ID</th>
                <th>Subject</th>
                <th>Received At</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for msg in messages %}
              <tr class="{% if not msg.is_read %}table-warning{% endif %}">
                <td>{{ msg.sender.get_full_name|default:msg.sender.username }}</td>
                <td>
                  {% if msg.order %}
                    <a href="{% url 'order_detail' msg.order.id %}">{{ msg.order.id }}</a>
                  {% else %}
                    N/A
                  {% endif %}
                </td>
                <td>{{ msg.subject }}</td>
                <td>{{ msg.timestamp|date:"Y-m-d H:i" }}</td>
                <td>
                  {% if msg.is_read %}
                    <span class="badge bg-success">Read</span>
                  {% else %}
                    <span class="badge bg-warning text-dark">Unread</span>
                  {% endif %}
                </td>
                <td>
                  <a href="{% url 'view_message' msg.id %}" class="btn btn-sm btn-primary">View</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-info mt-3">
          No messages found.
        </div>
      {% endif %}

    </div>

  </div>
</div>
{% endblock %}
